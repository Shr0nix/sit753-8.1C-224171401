pipeline {
  agent any

  tools {
    git    'Default'
    nodejs 'Node_18'
  }

  triggers {
    pollSCM('H/5 * * * *')
  }

  stages {
    stage('Debug workspace') {
      steps {
        bat 'echo CURRENT DIR: %CD%'
        bat 'dir /B'
      }
    }

    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Install Dependencies') {
      steps {
        // Ensure package.json is at the root of your repo
        bat 'npm install'
      }
    }

    stage('Unit & Integration Tests') {
      steps {
        bat 'npm test'
      }
    }

    stage('Static Code Analysis') {
      steps {
        echo 'Skipping Static Code Analysis'
      }
    }

    stage('Security Scan') {
      steps {
        echo 'Skipping Security Scan'
      }
    }

    stage('Deploy to Staging') {
      steps {
        echo 'Skipping Deploy to Staging'
      }
    }

    stage('Email Notification') {
      steps {
        echo 'Skipping Email Notification'
      }
    }
  }

  post {
    always {
      echo "Build ${currentBuild.fullDisplayName} finished with status ${currentBuild.currentResult}"
    }
  }
}

pipeline {
  agent any

  tools {
    git    'Default'    // your auto-installed Git tool
    nodejs 'Node_18'    // your NodeJS install
  }

  triggers {
    pollSCM('H/5 * * * *')   // poll for changes every 5 minutes
  }

  stages {
    stage('Debug workspace') {
      steps {
        bat 'echo CURRENT DIR: %CD%'
        bat 'dir /B'
      }
    }

    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Install Dependencies') {
      steps {
        // Adjust folder name to match where package.json now lives
        dir('jenkinsfile') {
          bat 'npm install'
        }
      }
    }

    stage('Unit & Integration Tests') {
      steps {
        dir('jenkinsfile') {
          bat 'npm test'
        }
      }
    }

    stage('Static Code Analysis') {
      steps {
        echo 'Skipping Static Code Analysis'
      }
    }

    stage('Security Scan') {
      steps {
        echo 'Skipping Security Scan'
      }
    }

    stage('Deploy to Staging') {
      steps {
        echo 'Skipping Deploy to Staging'
      }
    }

    stage('Email Notification') {
      steps {
        echo 'Skipping Email Notification'
      }
    }
  }

  post {
    always {
      echo "Build ${currentBuild.fullDisplayName} finished with status ${currentBuild.currentResult}"
    }
  }
}

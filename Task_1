pipeline {
  agent any

  tools {
    git    'Default'     // your auto-installed Git tool
    nodejs 'Node_18'     // your NodeJS install
  }

  triggers {
    pollSCM('H/5 * * * *')
  }

  stages {
    stage('Debug workspace') {
      steps {
        bat 'echo === CURRENT DIR ==='
        bat 'echo %CD%'
        bat 'echo === ROOT FILES & FOLDERS ==='
        bat 'dir /B'
      }
    }

    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Install Dependencies') {
      steps {
        dir('Task_1') {
          bat 'npm install'
        }
      }
    }

    stage('Unit & Integration Tests') {
      steps {
        dir('Task_1') {
          bat 'npm test'
        }
      }
    }

    stage('Static Code Analysis') {
      steps {
        echo 'Skipping Static Code Analysis (no lint step configured)'
      }
    }

    stage('Security Scan') {
      steps {
        echo 'Skipping Security Scan (no audit step configured)'
      }
    }

    stage('Deploy to Staging') {
      steps {
        echo 'Skipping Deploy to Staging (not implemented yet)'
      }
    }

    stage('Email Notification') {
      steps {
        echo 'Skipping Email Notification (to be added later)'
      }
    }
  }

  post {
    always {
      echo "Build ${currentBuild.fullDisplayName} finished with status ${currentBuild.currentResult}"
    }
  }
}
